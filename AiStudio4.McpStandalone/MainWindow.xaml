<ui:FluentWindow x:Class="AiStudio4.McpStandalone.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AiStudio4.McpStandalone"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="AiStudio4 Standalone MCP Server" 
        Height="800" 
        Width="1400"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        WindowCornerPreference="Round">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" 
                    Title="AiStudio4 Standalone MCP Server" 
                    ShowMaximize="True"
                    CanMaximize="True"/>

        <!-- Navigation View with Always Visible Sidebar -->
        <ui:NavigationView Grid.Row="1"
                          x:Name="RootNavigation"
                          PaneDisplayMode="Left"
                          IsPaneToggleVisible="False"
                          IsBackButtonVisible="Collapsed"
                          IsPaneOpen="True"
                          OpenPaneLength="250">
            
            <!-- Navigation Items -->
            <ui:NavigationView.MenuItems>
                <ui:NavigationViewItem Content="Server" 
                                      Tag="Server"
                                      Icon="{ui:SymbolIcon Server24}"
                                      Click="NavigationItem_Click"/>
                <ui:NavigationViewItem Content="Tools" 
                                      Tag="Tools"
                                      Icon="{ui:SymbolIcon Apps24}"
                                      Click="NavigationItem_Click"/>
                <ui:NavigationViewItem Content="Settings" 
                                      Tag="Settings"
                                      Icon="{ui:SymbolIcon Settings24}"
                                      Click="NavigationItem_Click"/>
                <ui:NavigationViewItem Content="Legacy" 
                                      Tag="Legacy"
                                      Icon="{ui:SymbolIcon History24}"
                                      Click="NavigationItem_Click"/>
            </ui:NavigationView.MenuItems>

            <!-- Page Content Frame -->
            <ui:NavigationView.ContentOverlay>
                <Frame x:Name="ContentFrame" 
                       NavigationUIVisibility="Hidden"/>
            </ui:NavigationView.ContentOverlay>
        </ui:NavigationView>

        <!-- Status Bar - Always visible, full width -->
        <ui:Card Grid.Row="2" 
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <ui:SymbolIcon Symbol="{Binding IsOAuthServerRunning, Converter={StaticResource BoolToIconConverter}}" 
                                  Margin="0,0,8,0"
                                  VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding OAuthServerStatus}" 
                              Margin="0,0,16,0"
                              VerticalAlignment="Center"/>
                    
                    <ui:SymbolIcon Symbol="{Binding IsMcpServerRunning, Converter={StaticResource BoolToIconConverter}}" 
                                  Margin="0,0,8,0"
                                  VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding McpServerStatus}" 
                              FontWeight="SemiBold"
                              VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Restart notification and button OR Reconnect info -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <!-- Restart needed -->
                    <StackPanel Orientation="Horizontal" 
                               Visibility="{Binding NeedsRestart, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="{Binding RestartMessage}" 
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource SystemFillColorCautionBrush}"
                                  Margin="0,0,8,0"/>
                        <ui:Button Content="Restart Server" 
                                  Command="{Binding RestartServerCommand}"
                                  Appearance="Primary"
                                  Height="32"/>
                    </StackPanel>
                    
                    <!-- Reconnect info after restart -->
                    <StackPanel Orientation="Horizontal"
                               Visibility="{Binding ShowReconnectInfo, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ui:SymbolIcon Symbol="Info16" 
                                      Foreground="{DynamicResource SystemFillColorSuccessBrush}"
                                      Margin="0,0,4,0"
                                      VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ReconnectInfoMessage}" 
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource SystemFillColorSuccessBrush}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </ui:Card>
    </Grid>
</ui:FluentWindow>