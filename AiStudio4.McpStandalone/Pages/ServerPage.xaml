<Page x:Class="AiStudio4.McpStandalone.Pages.ServerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="1000"
      Title="Server">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Page Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,24">
                <TextBlock Text="Server Management" 
                          FontSize="28" 
                          FontWeight="Bold"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                <TextBlock Text="Monitor and control your MCP and OAuth servers" 
                          FontSize="14" 
                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                          Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Big Status Indicator -->
            <ui:Card Grid.Row="1" Margin="0,0,0,24" Padding="24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Large Server Icon -->
                    <ui:SymbolIcon Grid.Column="0" 
                                  Symbol="Server24" 
                                  FontSize="64"
                                  Margin="0,0,24,0"
                                  VerticalAlignment="Center">
                        <ui:SymbolIcon.Style>
                            <Style TargetType="ui:SymbolIcon">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="True">
                                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorSuccessBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="False">
                                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorCriticalBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ui:SymbolIcon.Style>
                    </ui:SymbolIcon>
                    
                    <!-- Status Summary -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock FontSize="20" FontWeight="SemiBold">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="True">
                                            <Setter Property="Text" Value="Server is Running"/>
                                            <Setter Property="Foreground" Value="{DynamicResource SystemFillColorSuccessBrush}"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="False">
                                            <Setter Property="Text" Value="Server is Stopped"/>
                                            <Setter Property="Foreground" Value="{DynamicResource SystemFillColorCriticalBrush}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        
                        <TextBlock FontSize="14" 
                                  Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                  TextWrapping="Wrap"
                                  Margin="0,8,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="True">
                                            <Setter Property="Text" Value="Your MCP server is operational and ready to accept connections from MCP clients. All configured tools are available for use."/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsMcpServerRunning}" Value="False">
                                            <Setter Property="Text" Value="The MCP server is not currently running. Please check your configuration in the Settings page and ensure all required API keys are configured."/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        
                        <!-- Restart button if needed -->
                        <ui:Button Content="Restart Server" 
                                  Command="{Binding RestartServerCommand}"
                                  Icon="{ui:SymbolIcon ArrowClockwise24}"
                                  Appearance="Primary"
                                  Visibility="{Binding NeedsRestart, Converter={StaticResource BoolToVisibilityConverter}}"
                                  HorizontalAlignment="Left"
                                  Margin="0,12,0,0"/>
                    </StackPanel>
                </Grid>
            </ui:Card>

            <!-- Server Content -->
            <StackPanel Grid.Row="2">
                <!-- MCP Server Status -->
                <ui:CardExpander IsExpanded="False" Margin="0,0,0,16">
                    <ui:CardExpander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <ui:SymbolIcon Grid.Column="0" 
                                          Symbol="Server24" 
                                          Margin="0,0,12,0"/>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="MCP Server Details" 
                                          FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding McpServerStatus}" 
                                          FontSize="12" 
                                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </Grid>
                    </ui:CardExpander.Header>
                    
                    <StackPanel Margin="52,12,12,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                      Text="Server Name:" 
                                      Margin="0,4"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                      Text="{Binding SelectedServer.Name}" 
                                      FontWeight="SemiBold"
                                      Margin="0,4"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                      Text="Description:" 
                                      Margin="0,4"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" 
                                      Text="{Binding SelectedServer.Description}"
                                      TextWrapping="Wrap"
                                      Margin="0,4"/>
                        </Grid>
                        
                        <!-- Claude Installation Command -->
                        <ui:Card Margin="0,16,0,0" Padding="12">
                            <StackPanel>
                                <TextBlock Text="Claude Code Installation Command" 
                                          FontWeight="SemiBold" 
                                          Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBox Grid.Column="0" 
                                               Text="{Binding ClaudeInstallCommand, Mode=OneWay}"
                                               IsReadOnly="True"
                                               FontFamily="Cascadia Code, Consolas, monospace"
                                               FontSize="12"/>
                                    <ui:Button Grid.Column="1" 
                                              Content="Copy"
                                              Icon="{ui:SymbolIcon Copy24}"
                                              Margin="8,0,0,0"
                                              Click="CopyCommand_Click"/>
                                </Grid>
                            </StackPanel>
                        </ui:Card>
                    </StackPanel>
                </ui:CardExpander>

                <!-- OAuth Server Status -->
                <ui:Card Margin="0,0,0,16" Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <ui:SymbolIcon Grid.Column="0" 
                                      Symbol="Shield24" 
                                      Margin="0,0,12,0"/>
                        
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="OAuth Server" 
                                      FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding OAuthServerStatus}" 
                                      FontSize="12" 
                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>
                </ui:Card>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>